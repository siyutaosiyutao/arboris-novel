# ğŸ¤– AIåŠŸèƒ½åˆ†ç±»ä¸æ‹†åˆ†æ–¹æ¡ˆ

**æ—¥æœŸ**: 2025-10-30  
**ç›®çš„**: å°†é¡¹ç›®ä¸­çš„AIåŠŸèƒ½æ¨¡å—åŒ–ï¼Œä¾¿äºç‹¬ç«‹é…ç½®ã€ç›‘æ§å’Œä¼˜åŒ–

---

## ğŸ“Š å½“å‰AIåŠŸèƒ½å…¨æ™¯å›¾

### 1ï¸âƒ£ **æ¦‚å¿µç”Ÿæˆï¼ˆConcept Generationï¼‰**
**åŠŸèƒ½**: ä»ç”¨æˆ·æƒ³æ³•ç”Ÿæˆå®Œæ•´çš„å°è¯´è“å›¾  
**æç¤ºè¯**: `concept.md`  
**è°ƒç”¨ä½ç½®**: `novel_service.py` (å¯¹è¯å¼ç”Ÿæˆ)  
**è¾“å…¥**: ç”¨æˆ·å¯¹è¯å†å²  
**è¾“å‡º**: å®Œæ•´çš„Blueprintï¼ˆæ ‡é¢˜ã€é£æ ¼ã€ä¸–ç•Œè§‚ã€è§’è‰²ã€å¤§çº²ï¼‰

**ç‰¹ç‚¹**:
- å¤šè½®å¯¹è¯å¼äº¤äº’
- ä¸€æ¬¡æ€§ç”Ÿæˆå®Œæ•´è®¾å®š
- åˆ›é€ æ€§æœ€é«˜ï¼ˆtemperatureé«˜ï¼‰

---

### 2ï¸âƒ£ **å¤§çº²ç”Ÿæˆï¼ˆOutline Generationï¼‰**
**åŠŸèƒ½**: æ‰¹é‡ç”Ÿæˆç« èŠ‚å¤§çº²ï¼ˆ10ç« /æ¬¡ï¼‰  
**æç¤ºè¯**: `outline.md`  
**è°ƒç”¨ä½ç½®**: `auto_generator_service._auto_generate_outlines()`  
**è¾“å…¥**: 
- å®Œæ•´Blueprint
- å·²å®Œæˆç« èŠ‚æ‘˜è¦
- èµ·å§‹ç« èŠ‚å· + æ•°é‡

**è¾“å‡º**: 
```json
{
  "chapters": [
    {"chapter_number": 1, "title": "...", "summary": "..."}
  ]
}
```

**ç‰¹ç‚¹**:
- æ‰¹é‡ç”Ÿæˆï¼ˆ10ç« ï¼‰
- å‚è€ƒå·²å®Œæˆå†…å®¹
- ç¡®ä¿å‰§æƒ…è¿è´¯

---

### 3ï¸âƒ£ **ç« èŠ‚æ­£æ–‡ç”Ÿæˆï¼ˆChapter Writingï¼‰**
**åŠŸèƒ½**: æ ¹æ®å¤§çº²ç”Ÿæˆç« èŠ‚æ­£æ–‡  
**æç¤ºè¯**: `writing.md` æˆ– `screenwriting.md`  
**è°ƒç”¨ä½ç½®**: `auto_generator_service._generate_chapter_content()`  
**è¾“å…¥**:
- Blueprint
- ç« èŠ‚å¤§çº²
- RAGæ£€ç´¢çš„ä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰
- å†™ä½œæŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰

**è¾“å‡º**: å®Œæ•´ç« èŠ‚æ­£æ–‡ï¼ˆ3000-5000å­—ï¼‰

**ç‰¹ç‚¹**:
- æ”¯æŒå¤šç‰ˆæœ¬ç”Ÿæˆ
- æ”¯æŒRAGå¢å¼º
- å¯é€‰å‰§æœ¬æ ¼å¼

---

### 4ï¸âƒ£ **ç« èŠ‚æ‘˜è¦æå–ï¼ˆSummary Extractionï¼‰**
**åŠŸèƒ½**: ä»ç« èŠ‚æ­£æ–‡æå–ç®€çŸ­æ‘˜è¦  
**æç¤ºè¯**: `extraction.md`  
**è°ƒç”¨ä½ç½®**: `llm_service.get_summary()`  
**è¾“å…¥**: ç« èŠ‚æ­£æ–‡  
**è¾“å‡º**: 100-200å­—æ‘˜è¦

**ç‰¹ç‚¹**:
- ä½temperatureï¼ˆ0.15-0.2ï¼‰
- å¿«é€Ÿæ‰§è¡Œ
- ç”¨äºåç»­å¤§çº²ç”Ÿæˆ

---

### 5ï¸âƒ£ **åŸºç¡€åˆ†æï¼ˆBasic Analysisï¼‰**
**åŠŸèƒ½**: æå–ç« èŠ‚æ‘˜è¦å’Œå…³é”®äº‹ä»¶  
**æç¤ºè¯**: å†…åµŒåœ¨ä»£ç ä¸­  
**è°ƒç”¨ä½ç½®**: `super_analysis_service._basic_analysis()`  
**è¾“å…¥**: ç« èŠ‚æ­£æ–‡  
**è¾“å‡º**:
```json
{
  "summary": "ç« èŠ‚æ‘˜è¦",
  "key_events": ["äº‹ä»¶1", "äº‹ä»¶2"]
}
```

**ç‰¹ç‚¹**:
- å¿…é¡»æˆåŠŸ
- ç»“æ„ç®€å•
- å¿«é€Ÿæ‰§è¡Œ

---

### 6ï¸âƒ£ **å¢å¼ºåˆ†æï¼ˆEnhanced Analysisï¼‰**
**åŠŸèƒ½**: æ·±åº¦åˆ†æè§’è‰²ã€ä¸–ç•Œè§‚ã€ä¼ç¬”ç­‰  
**æç¤ºè¯**: å†…åµŒåœ¨ä»£ç ä¸­  
**è°ƒç”¨ä½ç½®**: `super_analysis_service._enhanced_analysis()`  
**è¾“å…¥**: 
- ç« èŠ‚æ­£æ–‡
- Blueprint

**è¾“å‡º**:
```json
{
  "character_changes": [...],
  "new_characters": [...],
  "world_extensions": {...},
  "foreshadowing": [...],
  "emotional_arcs": [...]
}
```

**ç‰¹ç‚¹**:
- å¯é€‰åŠŸèƒ½
- å¤±è´¥ä¸å½±å“ä¸»æµç¨‹
- å¯å¼‚æ­¥æ‰§è¡Œ

---

### 7ï¸âƒ£ **ç« èŠ‚è¯„ä¼°ï¼ˆChapter Evaluationï¼‰**
**åŠŸèƒ½**: è¯„ä¼°ç« èŠ‚è´¨é‡å¹¶ç»™å‡ºæ”¹è¿›å»ºè®®  
**æç¤ºè¯**: `evaluation.md`  
**è°ƒç”¨ä½ç½®**: æœªå®ç°ï¼ˆé¢„ç•™ï¼‰  
**è¾“å…¥**: ç« èŠ‚æ­£æ–‡  
**è¾“å‡º**: è¯„åˆ† + åé¦ˆ

**ç‰¹ç‚¹**:
- è´¨é‡æ§åˆ¶
- è‡ªåŠ¨åŒ–è¯„å®¡
- å¯ç”¨äºè‡ªåŠ¨é‡å†™

---

### 8ï¸âƒ£ **å‘é‡åµŒå…¥ï¼ˆEmbeddingï¼‰**
**åŠŸèƒ½**: ç”Ÿæˆæ–‡æœ¬å‘é‡ç”¨äºRAGæ£€ç´¢
**è°ƒç”¨ä½ç½®**:
- `chapter_ingest_service` (ç« èŠ‚å…¥åº“)
- `chapter_context_service` (æ£€ç´¢æŸ¥è¯¢)

**è¾“å…¥**: æ–‡æœ¬ç‰‡æ®µ
**è¾“å‡º**: å‘é‡æ•°ç»„

**ç‰¹ç‚¹**:
- éç”Ÿæˆå¼
- ç”¨äºè¯­ä¹‰æ£€ç´¢
- æ”¯æŒå¤šæ¨¡å‹

---

### 9ï¸âƒ£ **å‰§æƒ…æŒ‡æ ‡åˆ†æï¼ˆStory Metrics Analysisï¼‰** ğŸ†•
**åŠŸèƒ½**: åˆ†æç« èŠ‚å‰§æƒ…æŒ‡æ ‡ï¼Œç”¨äºè‡ªåŠ¨åˆ†å·åˆ¤å®š
**æç¤ºè¯**: å†…åµŒåœ¨ä»£ç ä¸­
**è°ƒç”¨ä½ç½®**: `story_metrics_service.analyze_chapter()`
**è¾“å…¥**:
- ç« èŠ‚æ­£æ–‡
- å¢å¼ºåˆ†æç»“æœ
- åŸºç¡€æ‘˜è¦

**è¾“å‡º**:
```json
{
  "key_event_count": 3,
  "major_event_flag": true,
  "character_breakthrough_flag": true,
  "world_shock_flag": false,
  "foreshadow_count": 2,
  "foreshadow_max_conf": 0.85,
  "climax_score": 75,
  "stage_score": 72
}
```

**ç‰¹ç‚¹**:
- æ•°æ®é©±åŠ¨
- å¯é…ç½®æƒé‡
- ç”¨äºè‡ªåŠ¨åˆ†å·

---

### ğŸ”Ÿ **å·åç”Ÿæˆï¼ˆVolume Namingï¼‰** ğŸ†•
**åŠŸèƒ½**: æ ¹æ®å‰§æƒ…é«˜æ½®ç”Ÿæˆå·å
**æç¤ºè¯**: `volume_naming.md`ï¼ˆæ–°å¢ï¼‰
**è°ƒç”¨ä½ç½®**: `volume_split_service.generate_volume_title()`
**è¾“å…¥**:
- ç« èŠ‚èŒƒå›´
- é‡å¤§äº‹ä»¶æ‘˜è¦
- å‰§æƒ…æŒ‡æ ‡

**è¾“å‡º**: å·åï¼ˆå¦‚"å·äº”Â·æ˜Ÿé™¨ä¹‹å¤œ"ï¼‰

**ç‰¹ç‚¹**:
- åˆ›æ„æ€§é«˜
- ä¸€æ¬¡æ€§è°ƒç”¨
- æœ‰fallbackç­–ç•¥

---

## ğŸ¯ æ¨èçš„æ‹†åˆ†æ–¹æ¡ˆï¼ˆåŸºäºæ¨¡å‹èƒ½åŠ›å’Œæˆæœ¬ä¼˜åŒ–ï¼‰

### â­ **æœ€ç»ˆæ¨èæ–¹æ¡ˆï¼šæŒ‰æ¨¡å‹èƒ½åŠ›éœ€æ±‚åˆ†ç±»**

æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚ï¼Œå°†AIåŠŸèƒ½æŒ‰**æ‰€éœ€æ¨¡å‹èƒ½åŠ›**å’Œ**æˆæœ¬æ•ˆç›Š**åˆ†ä¸º6å¤§ç±»ï¼š

---

### 1ï¸âƒ£ **ç« èŠ‚æ­£æ–‡ç”Ÿæˆï¼ˆCreative Writingï¼‰** ğŸ”¥
**æ ¸å¿ƒèƒ½åŠ›éœ€æ±‚**: åˆ›ä½œèƒ½åŠ›ã€ä¸Šä¸‹æ–‡ç†è§£ã€æ–‡å­¦æ€§
**æ¨èæ¨¡å‹**: GPT-4ã€GPT-4oã€Claude 3 Opusã€Gemini 1.5 Pro
**æˆæœ¬**: ğŸ’°ğŸ’°ğŸ’° é«˜
**ä¼˜å…ˆçº§**: â­â­â­ æ ¸å¿ƒï¼ˆå¿…é¡»æˆåŠŸï¼‰

**åŒ…å«åŠŸèƒ½**:
- ç« èŠ‚æ­£æ–‡ç”Ÿæˆï¼ˆå¤šç‰ˆæœ¬ï¼‰
- è‡ªåŠ¨ç‰ˆæœ¬é€‰æ‹©
- RAGå¢å¼ºå†™ä½œ

**ç‰¹ç‚¹**:
- å¯¹åˆ›ä½œèƒ½åŠ›è¦æ±‚æœ€é«˜
- éœ€è¦ç†è§£å¤æ‚ä¸Šä¸‹æ–‡
- ç”¨æˆ·ä½“éªŒæœ€å…³é”®
- é€‚åˆç”¨ä¸»åŠ›å†™ä½œæ¨¡å‹

**é…ç½®ç¤ºä¾‹**:
```json
{
  "function_type": "creative_writing",
  "model": "gpt-4o",
  "temperature": 0.75,
  "max_retries": 3,
  "timeout": 600,
  "fallback_model": "claude-3-sonnet"
}
```

---

### 2ï¸âƒ£ **ç»“æ„è§„åˆ’ç±»ç”Ÿæˆï¼ˆStructural Planningï¼‰** ğŸ“‹
**æ ¸å¿ƒèƒ½åŠ›éœ€æ±‚**: é€»è¾‘è§„åˆ’ã€ç»“æ„åŒ–è¾“å‡ºã€å‘½ååˆ›æ„
**æ¨èæ¨¡å‹**: Claude 3 Sonnetã€DeepSeek-Chatã€GPT-4o-mini
**æˆæœ¬**: ğŸ’°ğŸ’° ä¸­
**ä¼˜å…ˆçº§**: â­â­ é‡è¦ï¼ˆå¤±è´¥éœ€é‡è¯•ï¼‰

**åŒ…å«åŠŸèƒ½**:
- å¤§çº²ç”Ÿæˆï¼ˆ10ç« æ‰¹é‡ï¼‰
- åˆ†å·è‡ªåŠ¨å‘½å
- ç« èŠ‚æ ‡é¢˜ç”Ÿæˆ
- Screenwritingæ ¼å¼è½¬æ¢

**ç‰¹ç‚¹**:
- åç»“æ„è§„åˆ’ï¼Œä¸éœ€è¦æå¼ºæ–‡å­¦æ€§
- éœ€è¦é€»è¾‘è¿è´¯æ€§
- å¯ä»¥ç”¨æˆæœ¬æ›´ä½çš„æ¨¡å‹
- é€‚åˆæ“…é•¿é€»è¾‘è§„åˆ’çš„æ¨¡å‹

**é…ç½®ç¤ºä¾‹**:
```json
{
  "function_type": "structural_planning",
  "model": "deepseek-chat",
  "temperature": 0.7,
  "max_retries": 3,
  "timeout": 360,
  "fallback_model": "gpt-4o-mini"
}
```

---

### 3ï¸âƒ£ **ç« èŠ‚æ‘˜è¦ä¸å…³é”®ä¿¡æ¯æŠ½å–ï¼ˆSummarization & Extractionï¼‰** ğŸ“
**æ ¸å¿ƒèƒ½åŠ›éœ€æ±‚**: ä¿¡æ¯å‹ç¼©ã€å…³é”®ç‚¹æå–ã€å¿«é€Ÿå“åº”
**æ¨èæ¨¡å‹**: Gemini 1.5 Flashã€GPT-4o-miniã€GPT-3.5-turbo
**æˆæœ¬**: ğŸ’° ä½
**ä¼˜å…ˆçº§**: â­â­â­ æ ¸å¿ƒï¼ˆå¿…é¡»æˆåŠŸï¼‰

**åŒ…å«åŠŸèƒ½**:
- ç« èŠ‚æ‘˜è¦æå–
- åŸºç¡€åˆ†æï¼ˆæ‘˜è¦+å…³é”®äº‹ä»¶ï¼‰
- RAGå‰çš„è¾…åŠ©æ€»ç»“
- å¿«é€Ÿä¿¡æ¯æå–

**ç‰¹ç‚¹**:
- ä¸»è¦è¯„ä¼°/å‹ç¼©æ–‡æœ¬
- éœ€è¦å¿«é€Ÿå“åº”
- ç”¨é«˜ååé‡æ¨¡å‹
- æˆæœ¬æ•æ„Ÿ

**é…ç½®ç¤ºä¾‹**:
```json
{
  "function_type": "summarization",
  "model": "gemini-1.5-flash",
  "temperature": 0.15,
  "max_retries": 2,
  "timeout": 120,
  "fallback_model": "gpt-4o-mini"
}
```

---

### 4ï¸âƒ£ **å¢å¼ºåˆ†æï¼ˆEnhanced Analysisï¼‰** ğŸ”
**æ ¸å¿ƒèƒ½åŠ›éœ€æ±‚**: ä¿¡æ¯æŠ½å–ã€ä¸€è‡´æ€§æ£€æŸ¥ã€ç»†èŠ‚ç†è§£
**æ¨èæ¨¡å‹**: GPT-4oã€Claude 3 Sonnetã€Gemini 1.5 Pro
**æˆæœ¬**: ğŸ’°ğŸ’° ä¸­
**ä¼˜å…ˆçº§**: â­ å¯é€‰ï¼ˆå¤±è´¥å¯é™çº§ï¼‰

**åŒ…å«åŠŸèƒ½**:
- è§’è‰²çŠ¶æ€è¿½è¸ª
- ä¸–ç•Œè§‚æ‰©å±•
- ä¼ç¬”è¯†åˆ«
- æƒ…æ„Ÿå¼§çº¿åˆ†æ
- å‰§æƒ…æŒ‡æ ‡åˆ†æï¼ˆç”¨äºè‡ªåŠ¨åˆ†å·ï¼‰

**ç‰¹ç‚¹**:
- éœ€è¦ç†è§£è§’è‰²æˆé•¿ã€è®¾å®šç»†èŠ‚
- å‡†ç¡®æ€§å¾ˆé‡è¦
- å¯ä»¥å¼‚æ­¥æ‰§è¡Œ
- å¤±è´¥ä¸å½±å“ä¸»æµç¨‹

**é…ç½®ç¤ºä¾‹**:
```json
{
  "function_type": "enhanced_analysis",
  "model": "gpt-4o",
  "temperature": 0.5,
  "max_retries": 1,
  "timeout": 300,
  "async_mode": true,
  "fallback_strategy": "skip"
}
```

---

### 5ï¸âƒ£ **åˆ›æ„é™„åŠ åˆ†æï¼ˆCreative Analysisï¼‰** ğŸ¨
**æ ¸å¿ƒèƒ½åŠ›éœ€æ±‚**: åˆ›æ„è¯„ä¼°ã€è´¨é‡åˆ¤æ–­ã€å»ºè®®ç”Ÿæˆ
**æ¨èæ¨¡å‹**: Claude 3 Sonnetã€GPT-4o-miniã€DeepSeek-Chat
**æˆæœ¬**: ğŸ’° ä½-ä¸­
**ä¼˜å…ˆçº§**: â­ å¯é€‰ï¼ˆå¤±è´¥å¯å¿½ç•¥ï¼‰

**åŒ…å«åŠŸèƒ½**:
- å¼ åŠ›åˆ†æ
- è§’è‰²ä¸€è‡´æ€§æ£€æŸ¥
- ä¼ç¬”æ£€æµ‹
- ç« èŠ‚è¯„ä¼°
- æ”¹è¿›å»ºè®®

**ç‰¹ç‚¹**:
- é’ˆå¯¹ç”Ÿæˆåçš„ç« èŠ‚
- è´¨é‡æ§åˆ¶ç±»åŠŸèƒ½
- å¯ä»¥ä¸å¢å¼ºåˆ†æå…±ç”¨æ¨¡å‹
- æˆ–ä½¿ç”¨æˆæœ¬æ›´ä½çš„æ›¿ä»£æ–¹æ¡ˆ

**é…ç½®ç¤ºä¾‹**:
```json
{
  "function_type": "creative_analysis",
  "model": "claude-3-sonnet",
  "temperature": 0.4,
  "max_retries": 1,
  "timeout": 180,
  "fallback_strategy": "skip"
}
```

---

### 6ï¸âƒ£ **æ¦‚å¿µ/è“å›¾å¯¹è¯ç±»ï¼ˆInteractive Concept Designï¼‰** ğŸ’¬
**æ ¸å¿ƒèƒ½åŠ›éœ€æ±‚**: äº¤äº’å¼é—®ç­”ã€å¼•å¯¼èƒ½åŠ›ã€åˆ›æ„æ¿€å‘
**æ¨èæ¨¡å‹**: Claude 3 Opusã€GPT-4oã€Gemini 1.5 Pro
**æˆæœ¬**: ğŸ’°ğŸ’° ä¸­
**ä¼˜å…ˆçº§**: â­â­ é‡è¦ï¼ˆç”¨æˆ·ä½“éªŒå…³é”®ï¼‰

**åŒ…å«åŠŸèƒ½**:
- æ¦‚å¿µå¯¹è¯å¼ç”Ÿæˆ
- è“å›¾è§„åˆ’å¼•å¯¼
- çµæ„Ÿæ”¶é›†
- å¤šè½®äº¤äº’ä¼˜åŒ–

**ç‰¹ç‚¹**:
- éœ€è¦äº¤äº’å¼é—®ç­”
- å–„äºå¼•å¯¼ç”¨æˆ·
- èŠå¤©ä½“éªŒå¾ˆé‡è¦
- é€‚åˆå¯¹è¯èƒ½åŠ›å¼ºçš„æ¨¡å‹

**é…ç½®ç¤ºä¾‹**:
```json
{
  "function_type": "interactive_concept",
  "model": "claude-3-opus",
  "temperature": 0.8,
  "max_retries": 2,
  "timeout": 300,
  "fallback_model": "gpt-4o"
}
```

---

## ğŸ“Š åŠŸèƒ½åˆ†ç±»å¯¹æ¯”è¡¨

| åŠŸèƒ½ç±»åˆ« | æ¨èæ¨¡å‹ | æˆæœ¬ | ä¼˜å…ˆçº§ | å¤±è´¥ç­–ç•¥ | å¼‚æ­¥æ”¯æŒ |
|---------|---------|------|--------|---------|---------|
| ç« èŠ‚æ­£æ–‡ç”Ÿæˆ | GPT-4o | é«˜ | æ ¸å¿ƒ | é‡è¯•3æ¬¡ | âŒ |
| ç»“æ„è§„åˆ’ | DeepSeek-Chat | ä¸­ | é‡è¦ | é‡è¯•3æ¬¡ | âŒ |
| æ‘˜è¦æŠ½å– | Gemini Flash | ä½ | æ ¸å¿ƒ | é‡è¯•2æ¬¡+fallback | âŒ |
| å¢å¼ºåˆ†æ | GPT-4o | ä¸­ | å¯é€‰ | è·³è¿‡ | âœ… |
| åˆ›æ„åˆ†æ | Claude Sonnet | ä½-ä¸­ | å¯é€‰ | è·³è¿‡ | âœ… |
| æ¦‚å¿µå¯¹è¯ | Claude Opus | ä¸­ | é‡è¦ | é‡è¯•2æ¬¡ | âŒ |

---

## ğŸ’° æˆæœ¬ä¼˜åŒ–ç­–ç•¥

### 1. åˆ†å±‚æ¨¡å‹ç­–ç•¥
```
é«˜æˆæœ¬æ¨¡å‹ï¼ˆGPT-4o/Claude Opusï¼‰
  â””â”€â”€ ä»…ç”¨äºæ ¸å¿ƒåˆ›ä½œå’Œäº¤äº’

ä¸­æˆæœ¬æ¨¡å‹ï¼ˆClaude Sonnet/DeepSeekï¼‰
  â””â”€â”€ ç”¨äºè§„åˆ’å’Œåˆ†æ

ä½æˆæœ¬æ¨¡å‹ï¼ˆGemini Flash/GPT-4o-miniï¼‰
  â””â”€â”€ ç”¨äºæ‘˜è¦å’Œå¿«é€Ÿæå–
```

### 2. åŠ¨æ€é™çº§ç­–ç•¥
```python
# ç¤ºä¾‹ï¼šç« èŠ‚ç”Ÿæˆå¤±è´¥æ—¶çš„é™çº§é“¾
GPT-4o (ä¸»åŠ›)
  â†’ Claude 3 Sonnet (é™çº§1)
  â†’ GPT-4o-mini (é™çº§2)
  â†’ æŠ¥é”™ç»™ç”¨æˆ·
```

### 3. å¼‚æ­¥æ‰§è¡Œç­–ç•¥
```
åŒæ­¥æ‰§è¡Œï¼ˆé˜»å¡ï¼‰:
  - ç« èŠ‚æ­£æ–‡ç”Ÿæˆ
  - æ‘˜è¦æŠ½å–
  - åŸºç¡€åˆ†æ

å¼‚æ­¥æ‰§è¡Œï¼ˆåå°ï¼‰:
  - å¢å¼ºåˆ†æ
  - åˆ›æ„åˆ†æ
  - å‰§æƒ…æŒ‡æ ‡åˆ†æ
```

---

## ğŸ¯ å…·ä½“æ˜ å°„è¡¨

| åŸåŠŸèƒ½ | æ–°åˆ†ç±» | æ¨èæ¨¡å‹ | æ¸©åº¦ | è¶…æ—¶ |
|--------|--------|---------|------|------|
| æ¦‚å¿µç”Ÿæˆ | æ¦‚å¿µå¯¹è¯ | Claude Opus | 0.8 | 300s |
| å¤§çº²ç”Ÿæˆ | ç»“æ„è§„åˆ’ | DeepSeek-Chat | 0.7 | 360s |
| ç« èŠ‚æ­£æ–‡ | æ­£æ–‡ç”Ÿæˆ | GPT-4o | 0.75 | 600s |
| æ‘˜è¦æå– | æ‘˜è¦æŠ½å– | Gemini Flash | 0.15 | 120s |
| åŸºç¡€åˆ†æ | æ‘˜è¦æŠ½å– | Gemini Flash | 0.3 | 180s |
| å¢å¼ºåˆ†æ | å¢å¼ºåˆ†æ | GPT-4o | 0.5 | 300s |
| ç« èŠ‚è¯„ä¼° | åˆ›æ„åˆ†æ | Claude Sonnet | 0.4 | 180s |
| å·åç”Ÿæˆ | ç»“æ„è§„åˆ’ | DeepSeek-Chat | 0.7 | 30s |
| å‰§æƒ…æŒ‡æ ‡ | å¢å¼ºåˆ†æ | GPT-4o | 0.3 | 180s |

---

## ğŸ”§ æŠ€æœ¯å®ç°å»ºè®®

### 1. åˆ›å»ºç‹¬ç«‹çš„AIåŠŸèƒ½æšä¸¾

```python
# app/schemas/ai_function.py

from enum import Enum

class AIFunctionType(str, Enum):
    """AIåŠŸèƒ½ç±»å‹"""
    # æ¦‚å¿µé˜¶æ®µ
    CONCEPT_GENERATION = "concept_generation"
    
    # è§„åˆ’é˜¶æ®µ
    OUTLINE_GENERATION = "outline_generation"
    
    # å†™ä½œé˜¶æ®µ
    CHAPTER_WRITING = "chapter_writing"
    SUMMARY_EXTRACTION = "summary_extraction"
    
    # åˆ†æé˜¶æ®µ
    BASIC_ANALYSIS = "basic_analysis"
    ENHANCED_ANALYSIS = "enhanced_analysis"
    
    # è¯„ä¼°é˜¶æ®µ
    CHAPTER_EVALUATION = "chapter_evaluation"
    
    # åŸºç¡€è®¾æ–½
    EMBEDDING = "embedding"


class AIFunctionPriority(str, Enum):
    """AIåŠŸèƒ½ä¼˜å…ˆçº§"""
    CRITICAL = "critical"    # æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»æˆåŠŸ
    IMPORTANT = "important"  # é‡è¦åŠŸèƒ½ï¼Œå¤±è´¥éœ€é‡è¯•
    OPTIONAL = "optional"    # å¯é€‰åŠŸèƒ½ï¼Œå¤±è´¥å¯å¿½ç•¥
    PREMIUM = "premium"      # å¢å€¼åŠŸèƒ½ï¼Œéœ€è¦æƒé™


# åŠŸèƒ½é…ç½®æ˜ å°„
AI_FUNCTION_CONFIG = {
    AIFunctionType.CONCEPT_GENERATION: {
        "priority": AIFunctionPriority.IMPORTANT,
        "prompt": "concept",
        "temperature": 0.8,
        "max_retries": 2,
        "timeout": 300,
    },
    AIFunctionType.OUTLINE_GENERATION: {
        "priority": AIFunctionPriority.IMPORTANT,
        "prompt": "outline",
        "temperature": 0.7,
        "max_retries": 3,
        "timeout": 360,
    },
    AIFunctionType.CHAPTER_WRITING: {
        "priority": AIFunctionPriority.CRITICAL,
        "prompt": "writing",
        "temperature": 0.75,
        "max_retries": 3,
        "timeout": 600,
    },
    AIFunctionType.SUMMARY_EXTRACTION: {
        "priority": AIFunctionPriority.CRITICAL,
        "prompt": "extraction",
        "temperature": 0.15,
        "max_retries": 2,
        "timeout": 120,
    },
    AIFunctionType.BASIC_ANALYSIS: {
        "priority": AIFunctionPriority.CRITICAL,
        "prompt": None,  # å†…åµŒ
        "temperature": 0.3,
        "max_retries": 2,
        "timeout": 180,
    },
    AIFunctionType.ENHANCED_ANALYSIS: {
        "priority": AIFunctionPriority.OPTIONAL,
        "prompt": None,  # å†…åµŒ
        "temperature": 0.5,
        "max_retries": 1,
        "timeout": 300,
    },
    AIFunctionType.CHAPTER_EVALUATION: {
        "priority": AIFunctionPriority.PREMIUM,
        "prompt": "evaluation",
        "temperature": 0.4,
        "max_retries": 1,
        "timeout": 180,
    },
    AIFunctionType.EMBEDDING: {
        "priority": AIFunctionPriority.IMPORTANT,
        "prompt": None,
        "temperature": None,
        "max_retries": 2,
        "timeout": 60,
    },
}
```

### 2. ç»Ÿä¸€çš„AIè°ƒç”¨æ¥å£

```python
# app/services/ai_orchestrator.py

class AIOrchestrator:
    """AIåŠŸèƒ½ç¼–æ’å™¨"""
    
    async def execute(
        self,
        function_type: AIFunctionType,
        user_id: int,
        **kwargs
    ) -> dict:
        """
        ç»Ÿä¸€çš„AIåŠŸèƒ½æ‰§è¡Œæ¥å£
        
        è‡ªåŠ¨å¤„ç†ï¼š
        - é…ç½®åŠ è½½
        - é‡è¯•é€»è¾‘
        - é”™è¯¯å¤„ç†
        - ç›‘æ§è®°å½•
        - é…é¢æ£€æŸ¥
        """
        config = AI_FUNCTION_CONFIG[function_type]
        
        # æ£€æŸ¥æƒé™
        if config["priority"] == AIFunctionPriority.PREMIUM:
            if not await self._check_premium_access(user_id):
                raise PermissionError("éœ€è¦é«˜çº§ä¼šå‘˜")
        
        # æ£€æŸ¥é…é¢
        await self._check_quota(user_id, function_type)
        
        # æ‰§è¡Œè°ƒç”¨ï¼ˆå¸¦é‡è¯•ï¼‰
        for attempt in range(config["max_retries"]):
            try:
                result = await self._call_ai(
                    function_type=function_type,
                    config=config,
                    **kwargs
                )
                
                # è®°å½•æˆåŠŸ
                await self._record_success(user_id, function_type)
                return result
                
            except Exception as e:
                if attempt == config["max_retries"] - 1:
                    # æœ€åä¸€æ¬¡é‡è¯•å¤±è´¥
                    await self._record_failure(user_id, function_type, e)
                    
                    # æ ¹æ®ä¼˜å…ˆçº§å†³å®šæ˜¯å¦æŠ›å‡ºå¼‚å¸¸
                    if config["priority"] == AIFunctionPriority.CRITICAL:
                        raise
                    else:
                        return self._get_fallback_result(function_type)
```

### 3. ç‹¬ç«‹çš„é…ç½®ç®¡ç†

```python
# æ•°æ®åº“è¡¨ï¼šai_function_configs
CREATE TABLE ai_function_configs (
    id INTEGER PRIMARY KEY,
    function_type VARCHAR(50) NOT NULL UNIQUE,
    priority VARCHAR(20) NOT NULL,
    enabled BOOLEAN DEFAULT TRUE,
    temperature FLOAT,
    max_retries INTEGER,
    timeout INTEGER,
    prompt_name VARCHAR(50),
    model_override VARCHAR(100),  -- å¯ä»¥ä¸ºç‰¹å®šåŠŸèƒ½æŒ‡å®šæ¨¡å‹
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

# ç”¨æˆ·çº§åˆ«çš„åŠŸèƒ½å¼€å…³
CREATE TABLE user_ai_function_access (
    id INTEGER PRIMARY KEY,
    user_id INTEGER NOT NULL,
    function_type VARCHAR(50) NOT NULL,
    enabled BOOLEAN DEFAULT TRUE,
    quota_limit INTEGER,  -- æ¯æ—¥é…é¢
    quota_used INTEGER DEFAULT 0,
    reset_at TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

---

## ğŸ“ˆ ç›‘æ§å’Œåˆ†æ

### ä¸ºæ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹è¿½è¸ªï¼š

```python
# PrometheusæŒ‡æ ‡
ai_function_calls_total = Counter(
    'ai_function_calls_total',
    'Total AI function calls',
    ['function_type', 'status']  # success/failure
)

ai_function_duration_seconds = Histogram(
    'ai_function_duration_seconds',
    'AI function execution time',
    ['function_type']
)

ai_function_token_usage = Counter(
    'ai_function_token_usage',
    'Token usage by function',
    ['function_type', 'token_type']  # input/output
)

ai_function_cost_usd = Counter(
    'ai_function_cost_usd',
    'Estimated cost by function',
    ['function_type']
)
```

---

## ğŸ¯ å®æ–½æ­¥éª¤

### é˜¶æ®µ1ï¼šåŸºç¡€æ‹†åˆ†ï¼ˆ1-2å¤©ï¼‰
1. åˆ›å»º `AIFunctionType` æšä¸¾
2. åˆ›å»º `AI_FUNCTION_CONFIG` é…ç½®
3. åœ¨ç°æœ‰ä»£ç ä¸­æ ‡è®°æ¯ä¸ªAIè°ƒç”¨çš„ç±»å‹

### é˜¶æ®µ2ï¼šç»Ÿä¸€æ¥å£ï¼ˆ2-3å¤©ï¼‰
1. åˆ›å»º `AIOrchestrator` ç±»
2. é‡æ„ç°æœ‰æœåŠ¡ä½¿ç”¨ç»Ÿä¸€æ¥å£
3. æ·»åŠ é‡è¯•å’Œé™çº§é€»è¾‘

### é˜¶æ®µ3ï¼šé…ç½®ç®¡ç†ï¼ˆ1-2å¤©ï¼‰
1. åˆ›å»ºæ•°æ®åº“è¡¨
2. å®ç°é…ç½®ç®¡ç†API
3. æ·»åŠ ç®¡ç†åå°ç•Œé¢

### é˜¶æ®µ4ï¼šç›‘æ§ä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
1. æ·»åŠ è¯¦ç»†çš„ç›‘æ§æŒ‡æ ‡
2. åˆ›å»ºç›‘æ§é¢æ¿
3. è®¾ç½®å‘Šè­¦è§„åˆ™

---

## ğŸ’° å•†ä¸šä»·å€¼

### 1. å·®å¼‚åŒ–å®šä»·
- å…è´¹ç”¨æˆ·ï¼šæ ¸å¿ƒåŠŸèƒ½
- æ ‡å‡†ä¼šå‘˜ï¼š+ å¢å¼ºåˆ†æ
- é«˜çº§ä¼šå‘˜ï¼š+ ç« èŠ‚è¯„ä¼° + æ›´é«˜é…é¢

### 2. æˆæœ¬ä¼˜åŒ–
- ä¸ºä¸åŒåŠŸèƒ½ä½¿ç”¨ä¸åŒæ¨¡å‹
- æ ¸å¿ƒåŠŸèƒ½ç”¨è´µçš„æ¨¡å‹ï¼ˆGPT-4ï¼‰
- å¯é€‰åŠŸèƒ½ç”¨ä¾¿å®œçš„æ¨¡å‹ï¼ˆGPT-3.5ï¼‰

### 3. æ€§èƒ½ä¼˜åŒ–
- è¯†åˆ«æ…¢åŠŸèƒ½å¹¶ä¼˜åŒ–
- å¼‚æ­¥æ‰§è¡Œå¯é€‰åŠŸèƒ½
- æ‰¹é‡å¤„ç†é™ä½æˆæœ¬

---

## ğŸ“ æ€»ç»“

**æ¨èæ–¹æ¡ˆ**: æ–¹æ¡ˆAï¼ˆæŒ‰é˜¶æ®µï¼‰+ æ–¹æ¡ˆCï¼ˆæŒ‰é‡è¦æ€§ï¼‰

**æ ¸å¿ƒä¼˜åŠ¿**:
1. âœ… ç”¨æˆ·è§†è§’æ¸…æ™°ï¼ˆæŒ‰åˆ›ä½œé˜¶æ®µï¼‰
2. âœ… æŠ€æœ¯å®ç°çµæ´»ï¼ˆæŒ‰é‡è¦æ€§åˆ†çº§ï¼‰
3. âœ… ä¾¿äºç›‘æ§å’Œä¼˜åŒ–
4. âœ… æ”¯æŒå·®å¼‚åŒ–å®šä»·
5. âœ… é™çº§ç­–ç•¥æ˜ç¡®

**ä¸‹ä¸€æ­¥**:
1. ç¡®è®¤åˆ†ç±»æ–¹æ¡ˆ
2. åˆ›å»ºæšä¸¾å’Œé…ç½®
3. é€æ­¥é‡æ„ç°æœ‰ä»£ç 
4. æ·»åŠ ç›‘æ§å’Œç®¡ç†ç•Œé¢
